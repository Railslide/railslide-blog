<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Railslide, Code, experiments, and thoughts">

        <link rel="alternate"  href="https://railslide.io/feeds/all.atom.xml" type="application/atom+xml" title="Railslide Full Atom Feed"/>

        <title>Going full in with Neovim // Railslide // Code, experiments, and thoughts</title>


    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.3.0/pure-min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://railslide.io/theme/css/puremorning.css">
    <link rel="stylesheet" href="https://railslide.io/theme/css/pygments.css">

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/fitvids/1.0.1/jquery.fitvids.min.js"></script>
    <script>
        $(document).ready(function(){
            $(".content").fitVids();
        });
    </script>
</head>

<body>
    <div class="pure-g-r" id="layout">
        <div class="sidebar pure-u">
            <div class="cover-img">
                <div class="cover-body">
                    <header class="header">
                        <hgroup>
                            <h1 class="brand-main"><a href="/">Railslide</a></h1>
                            <p class="tagline">Code, experiments, and thoughts</p>
                                <p class="links"><a href="/about.html">About</a></p>
                                <p class="links"><a href="/categories.html">Categories</a></p>
                                <p class="social">
                                    <a href="https://github.com/Railslide/">
                                        <i class="fa fa-github fa-3x"></i>
                                    </a>
                                    <a href="feeds/all.atom.xml">
                                        <i class="fa fa-rss fa-3x"></i>
                                    </a>
                                </p>
                        </hgroup>
                    </header>
                </div>
            </div>
        </div>
    <div class="pure-u">
        <div class="content">
            <section class="post">
                <header class="post-header">
                    <h1>Going full in with Neovim</h1>
                        <p class="post-meta">
                        category: <a href="https://railslide.io/category/dev.html">dev</a>, date: 21-01-2023
                        </p>
                        <p class="post-meta">
                            tags =                                 <a class="post-category" href="https://railslide.io/tag/editor.html">editor</a>
                                <a class="post-category" href="https://railslide.io/tag/vim.html">vim</a>
                                <a class="post-category" href="https://railslide.io/tag/neovim.html">neovim</a>
                                <a class="post-category" href="https://railslide.io/tag/tools.html">tools</a>
                </header>
            </section>
            <p>A while ago I decided to fully embrace Neovim and port all my config from <code>.vimrc</code> over to Lua.</p>
<h2>The why(s)</h2>
<p>First thing first, why Neovim? Because you basically get the full Vim experience, but with sane defaults and lsp support. Plus the project is community driven and has faster development cycles (multiple maintainers, less legacy code, etc.). Sure there are some differences, but so far I have yet to find myself in the situation where I fall back to Vim because I cannot do something in Neovim.</p>
<p>Ok, and what about Lua? When I started my <a href="https://railslide.io/learning-vim-in-2022.html">Vim adventure</a> I felt like I didn't know enough about Vim and Neovim to have a strong preference for one over the other, so I just placed all my config in <code>.vimrc</code> as that was compatible with both. But then time passed and two things happened: first, I realized I have never went back once to Vim after trying Neovim; second, Vim announced that from version 9.0 it will introduce a new scripting language (Vim 9 Script), which will not be completely backward-compatible with the old VimScript. For me that meant that, no matter which editor I chose, I would have to learn a new language. And if I have to put the effort, I'd rather do it for something multipurpose like Lua, than for a language that only applies to my editor.</p>
<h2>The structure</h2>
<p>After a bit of back and forth, this is what the directory structure of my config currently looks like:</p>
<div class="highlight"><pre><span></span><code><span class="n">nvim</span>
<span class="n">├── after</span>
<span class="n">│   └── plugin</span>
<span class="n">│       ├── ale.lua</span>
<span class="n">│       ├── lightline.vim.lua</span>
<span class="n">│       ├── onedark.lua</span>
<span class="n">│       └── telescope.lua</span>
<span class="n">├── init.lua</span>
<span class="n">├── lua</span>
<span class="n">│   └── railslide</span>
<span class="n">│       ├── mappings.lua</span>
<span class="n">│       ├── options.lua</span>
<span class="n">│       └── plugin-manager.lua</span>
<span class="n">└── plugin</span>
<span class="n">    └── packer_compiled.lua</span>
</code></pre></div>

<p>The <code>lua/railside</code> folder is where I keep my general configuration. The <code>lua</code> folder is included in Neovim <code>runtimepath</code> and it's where Neovim looks for Lua plugins by default. Inside that I created a directory with my own username in order to avoid namespace conflicts (the name per se doesn't actually matter, as long as it's something unlikely to be used by something else you're good to go).</p>
<p>All the files in the <code>railslide</code> folder are then imported in my <code>init.lua</code></p>
<div class="highlight"><pre><span></span><code><span class="nb">require</span><span class="p">(</span><span class="s2">&quot;railslide.plugin-manager&quot;</span><span class="p">)</span> <span class="c1">-- This needs to be at the top</span>
<span class="nb">require</span><span class="p">(</span><span class="s2">&quot;railslide.options&quot;</span><span class="p">)</span>
<span class="nb">require</span><span class="p">(</span><span class="s2">&quot;railslide.mappings&quot;</span><span class="p">)</span>
</code></pre></div>

<h2>Plugins</h2>
<p>A side effect of my config migration is that I switched to a new plugin manager as I decided that I wanted to go for something written in Lua. Packer seemed to be the most popular choice, so I went for that and so far it has been good. There are a lot of good reasons to use Packer, but one of the things I really appreciate is the <a href="https://github.com/wbthomason/packer.nvim#bootstrapping">bootstrapping snippet</a> which allows you to automatically install and set up Packer on a new machine.</p>
<p>My Packer settings and the list of installed plugins are stored in <code>lua/railslide/plugin-manager.lua</code>, while the files containing the configurations for the actual plugins are in the <code>after/plugin</code> folder, following a <code>&lt;plugin_name&gt;.lua</code> naming pattern. The cool thing with the <code>after</code> folder is that it gets automatically sourced (i.e. no need for me to explicitly require them in my <code>init.lua</code>) and, as the name suggests, that only happens after all the rest of my configurations have been loaded, which means no risk for plugins not picking up some other setting (e.g. the leader definition). Plus, having a file for each plugin makes it very easy for me to know where the settings for it are and to get rid of them if I were to decide to uninstall the plugin.</p>
<p>For Lua plugins I also decided to require them through a protected call, i.e.</p>
<div class="highlight"><pre><span></span><code><span class="n">status_ok</span><span class="p">,</span> <span class="n">some_plugin</span> <span class="o">=</span> <span class="nb">pcall</span><span class="p">(</span><span class="nb">require</span><span class="p">,</span> <span class="s1">&#39;some_plugin&#39;</span><span class="p">)</span>
<span class="kr">if</span> <span class="ow">not</span> <span class="n">status_ok</span> <span class="kr">then</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could not find some_plugin plugin&#39;</span><span class="p">)</span>
  <span class="kr">return</span>
<span class="kr">end</span>

<span class="n">some_plugin</span><span class="p">.</span><span class="n">setup</span><span class="p">(</span>
  <span class="c1">-- ...</span>
<span class="p">)</span>
</code></pre></div>

<p>That way if a plugin isn't correctly loaded, Neovim will display a message below the status line rather than printing out stack traces at start time. This has come in handy for me whenever I forgot to run <code>packerSync</code> after git pulling an updated copy of my dotfiles, as well as for when I want to temporarily disable a plugin without touching its configuration.</p>
<p>The <code>plugin/packed_compiled.lua</code> is where Packer stores the compiled code it uses for reducing startup time. I added it to <code>.gitignore</code> as there was no real benefit in committing it and I didn't want to <a href="https://github.com/wbthomason/packer.nvim/issues/462#issuecomment-876676720">pollute my git history</a>. Plus it will be generated anew anyway whenever I set up Neovim on a new machine.</p>
<h2>Use the source, Luke</h2>
<p>This is an overview of how my configuration looks and the reasoning that went behind it. So far it has served me well, but of course I'm always happy to find ways to further improve my setup. So if you're curious about the nitty-gritty and/or how my config might evolve in the future, <a href="https://github.com/Railslide/dotfiles/tree/master/neovim/.config/nvim">my dotfiles repo GitHub</a> is the place to go.</p>
            <a href="#" class="go-top">Go Top</a>
<footer class="footer">
    <p>&copy; Railslide <a href="http://creativecommons.org/licenses/by-sa/4.0/">(CC BY-SA 4.0)</a> &ndash;
        Built with <a href="http://blog.getpelican.com/">Pelican</a>
        and a modified version of <a href="https://github.com/PurePelicanTheme/pure-single">Pure Theme</a>
    </p>
</footer>        </div>
    </div>
    </div>
    <script>
        var $top = $('.go-top');

        // Show or hide the sticky footer button
        $(window).scroll(function() {
            if ($(this).scrollTop() > 200) {
                $top.fadeIn(200);
            } else {
                $top.fadeOut(200);
            }
        });

        // Animate the scroll to top
        $top.click(function(event) {
            event.preventDefault();
            $('html, body').animate({scrollTop: 0}, 300);
        })

        // Makes sure that the href="#" attached to the <a> elements
        // don't scroll you back up the page.
        $('body').on('click', 'a[href="#"]', function(event) {
            event.preventDefault();
        });
    </script>

</body>
</html>