<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Railslide, Code, experiments, and thoughts">

        <link rel="alternate"  href="https://railslide.io/feeds/all.atom.xml" type="application/atom+xml" title="Railslide Full Atom Feed"/>

        <title>How to create a GPG key with subkeys // Railslide // Code, experiments, and thoughts</title>


    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.3.0/pure-min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://railslide.io/theme/css/puremorning.css">
    <link rel="stylesheet" href="https://railslide.io/theme/css/pygments.css">

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/fitvids/1.0.1/jquery.fitvids.min.js"></script>
    <script>
        $(document).ready(function(){
            $(".content").fitVids();
        });
    </script>
</head>

<body>
    <div class="pure-g-r" id="layout">
        <div class="sidebar pure-u">
            <div class="cover-img">
                <div class="cover-body">
                    <header class="header">
                        <hgroup>
                            <h1 class="brand-main"><a href="/">Railslide</a></h1>
                            <p class="tagline">Code, experiments, and thoughts</p>
                                <p class="links"><a href="/about.html">About</a></p>
                                <p class="links"><a href="/categories.html">Categories</a></p>
                                <p class="social">
                                    <a href="https://github.com/Railslide/">
                                        <i class="fa fa-github fa-3x"></i>
                                    </a>
                                    <a href="feeds/all.atom.xml">
                                        <i class="fa fa-rss fa-3x"></i>
                                    </a>
                                </p>
                        </hgroup>
                    </header>
                </div>
            </div>
        </div>
    <div class="pure-u">
        <div class="content">
            <section class="post">
                <header class="post-header">
                    <h1>How to create a GPG key with subkeys</h1>
                        <p class="post-meta">
                        category: <a href="https://railslide.io/category/cryptography.html">cryptography</a>, date: 19-04-2017
                        </p>
                        <p class="post-meta">
                            tags =                                 <a class="post-category" href="https://railslide.io/tag/gpg.html">GPG</a>
                                <a class="post-category" href="https://railslide.io/tag/cryptography.html">cryptography</a>
                                <a class="post-category" href="https://railslide.io/tag/howto.html">howto</a>
                </header>
            </section>
            <p>I wanted to create a GPG key - so far so good. The problem is that I also wanted to use GPG on multiple devices, ideally even on my phone. I could have - <em>in theory</em> - copied the key over to all the needed machines, but that would have been a terrible idea. What if I lose my phone/laptop? My key would be compromised and I'd be left with no other choice than revoking it and losing all the previous signatures.</p>
<p>That's when subkeys come in.</p>
<p>Subkeys are almost identical to normal key pairs, except they can't be used for signing other people's keys, they're bound to a master key pair, and - here comes the interesting part! - they can be revoked independently from the master key.</p>
<p>So, in practical terms, they allow me to do the following: create a master key pair, create a subkey pair, remove the master key from my laptop, store it in a safe place, move on with my encrypting/decrypting life as usual. If catastrophe strikes, I retrieve my master key from its safe place, revoke the subkey, create a new subkey pair and I'm ready to go - and since each link of the Web of Trust is connected to the UID of the master key, my reputation stays untouched.</p>
<p>The only problem with all this workflow is that it requires a bunch of steps and I have the tendency to forget them pretty quickly. So, for the sake of my future self (or anyone else who might found them useful) here it is the whole process.</p>
<h2>Set GPG to prefer SHA2</h2>
<p>GPG defaults to SHA1 as preferred hash, so let's set it to prefer SHA2 instead.
Check if the following lines are present in <code>~/.gnupg/gpg.conf</code>:</p>
<div class="highlight"><pre><span></span><code>personal-digest-preferences SHA512 SHA384 SHA256 SHA224
default-preference-list SHA512 SHA384 SHA256 SHA224 AES256 AES192 AES CAST5 BZIP2 ZLIB ZIP Uncompressed
cert-digest-algo SHA512
</code></pre></div>

<p>If not, add them.</p>
<h2>Create a master key</h2>
<p>Create the master key - I'm going to mark user inputs with <code># [input value] &lt;--</code>.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>gpg<span class="w"> </span>--gen-key
gpg<span class="w"> </span><span class="o">(</span>GnuPG<span class="o">)</span><span class="w"> </span><span class="m">1</span>.4.11<span class="p">;</span><span class="w"> </span>Copyright<span class="w"> </span><span class="o">(</span>C<span class="o">)</span><span class="w"> </span><span class="m">2010</span><span class="w"> </span>Free<span class="w"> </span>Software<span class="w"> </span>Foundation,<span class="w"> </span>Inc.
This<span class="w"> </span>is<span class="w"> </span>free<span class="w"> </span>software:<span class="w"> </span>you<span class="w"> </span>are<span class="w"> </span>free<span class="w"> </span>to<span class="w"> </span>change<span class="w"> </span>and<span class="w">  </span>redistribute<span class="w"> </span>it.
There<span class="w"> </span>is<span class="w"> </span>NO<span class="w"> </span>WARRANTY,<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>extent<span class="w"> </span>permitted<span class="w"> </span>by<span class="w"> </span>law.

Please<span class="w"> </span><span class="k">select</span><span class="w"> </span>what<span class="w"> </span>kind<span class="w"> </span>of<span class="w"> </span>key<span class="w"> </span>you<span class="w"> </span>want:
<span class="w">    </span><span class="o">(</span><span class="m">1</span><span class="o">)</span><span class="w"> </span>RSA<span class="w"> </span>and<span class="w"> </span>RSA<span class="w"> </span><span class="o">(</span>default<span class="o">)</span>
<span class="w">    </span><span class="o">(</span><span class="m">2</span><span class="o">)</span><span class="w"> </span>DSA<span class="w"> </span>and<span class="w"> </span>Elgamal
<span class="w">    </span><span class="o">(</span><span class="m">3</span><span class="o">)</span><span class="w"> </span>DSA<span class="w"> </span><span class="o">(</span>sign<span class="w"> </span>only<span class="o">)</span>
<span class="w">    </span><span class="o">(</span><span class="m">4</span><span class="o">)</span><span class="w"> </span>RSA<span class="w"> </span><span class="o">(</span>sign<span class="w"> </span>only<span class="o">)</span>
<span class="w">    </span>Your<span class="w"> </span>selection?<span class="w"> </span><span class="c1"># 1 &lt;--</span>
</code></pre></div>

<p>When it comes to choosing the length make sure to choose the longest available option (4096 at the time of writing).</p>
<div class="highlight"><pre><span></span><code>RSA<span class="w"> </span>keys<span class="w"> </span>may<span class="w"> </span>be<span class="w"> </span>between<span class="w"> </span><span class="m">1024</span><span class="w"> </span>and<span class="w"> </span><span class="m">4096</span><span class="w"> </span>bits<span class="w"> </span>long.
What<span class="w"> </span>keysize<span class="w"> </span><span class="k">do</span><span class="w"> </span>you<span class="w"> </span>want?<span class="w"> </span><span class="o">(</span><span class="m">2048</span><span class="o">)</span><span class="w">  </span><span class="c1"># 4096 &lt;-- (the longer the better!)</span>

Requested<span class="w"> </span>keysize<span class="w"> </span>is<span class="w"> </span><span class="m">4096</span><span class="w"> </span>bits
Please<span class="w"> </span>specify<span class="w"> </span>how<span class="w"> </span>long<span class="w"> </span>the<span class="w"> </span>key<span class="w"> </span>should<span class="w"> </span>be<span class="w"> </span>valid.
<span class="w">    </span><span class="nv">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>key<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>expire
<span class="w">    </span>&lt;n&gt;<span class="w">  </span><span class="o">=</span><span class="w"> </span>key<span class="w"> </span>expires<span class="w"> </span><span class="k">in</span><span class="w"> </span>n<span class="w"> </span>days
<span class="w">    </span>&lt;n&gt;w<span class="w"> </span><span class="o">=</span><span class="w"> </span>key<span class="w"> </span>expires<span class="w"> </span><span class="k">in</span><span class="w"> </span>n<span class="w"> </span>weeks
<span class="w">    </span>&lt;n&gt;m<span class="w"> </span><span class="o">=</span><span class="w"> </span>key<span class="w"> </span>expires<span class="w"> </span><span class="k">in</span><span class="w"> </span>n<span class="w"> </span>months
<span class="w">    </span>&lt;n&gt;y<span class="w"> </span><span class="o">=</span><span class="w"> </span>key<span class="w"> </span>expires<span class="w"> </span><span class="k">in</span><span class="w"> </span>n<span class="w"> </span>years
Key<span class="w"> </span>is<span class="w"> </span>valid<span class="w"> </span><span class="k">for</span>?<span class="w"> </span><span class="o">(</span><span class="m">0</span><span class="o">)</span><span class="w"> </span><span class="c1"># 0 &lt;--</span>

Key<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>expire<span class="w"> </span>at<span class="w"> </span>all
Is<span class="w"> </span>this<span class="w"> </span>correct?<span class="w"> </span><span class="o">(</span>y/N<span class="o">)</span><span class="w"> </span><span class="c1"># y &lt;--</span>

You<span class="w"> </span>need<span class="w"> </span>a<span class="w"> </span>user<span class="w"> </span>ID<span class="w"> </span>to<span class="w"> </span>identify<span class="w"> </span>your<span class="w"> </span>key<span class="p">;</span><span class="w"> </span>the<span class="w"> </span>software<span class="w"> </span>constructs<span class="w"> </span>the<span class="w"> </span>user<span class="w"> </span>ID
from<span class="w"> </span>the<span class="w"> </span>Real<span class="w"> </span>Name,<span class="w"> </span>Comment<span class="w"> </span>and<span class="w"> </span>E-mail<span class="w"> </span>Address<span class="w"> </span><span class="k">in</span><span class="w"> </span>this<span class="w"> </span>form:
<span class="w">    </span><span class="s2">&quot;Heinrich Heine (Der Dichter) &lt;heinrichh@duesseldorf.de&gt;&quot;</span>

Real<span class="w"> </span>name:<span class="w"> </span><span class="c1"># [Your name] &lt;--</span>

E-mail<span class="w"> </span>address:<span class="w"> </span><span class="c1"># [Your email address] &lt;--</span>

Comment:
You<span class="w"> </span>selected<span class="w"> </span>this<span class="w"> </span>USER-ID:
<span class="w">    </span><span class="s2">&quot;[Your name] &lt;[your email address]&gt;&quot;</span>

Change<span class="w"> </span><span class="o">(</span>N<span class="o">)</span>ame,<span class="w"> </span><span class="o">(</span>C<span class="o">)</span>omment,<span class="w"> </span><span class="o">(</span>E<span class="o">)</span>-mail<span class="w"> </span>or<span class="w"> </span><span class="o">(</span>O<span class="o">)</span>kay/<span class="o">(</span>Q<span class="o">)</span>uit?<span class="w"> </span><span class="c1"># o &lt;--</span>
</code></pre></div>

<p>When prompted for a passphrase, make sure to choose a strong one - ideally long and hard to guess. If someone gets access to the secret key, the passphrase would be the only thing left to prevent them from using it.</p>
<div class="highlight"><pre><span></span><code>You<span class="w"> </span>need<span class="w"> </span>a<span class="w"> </span>Passphrase<span class="w"> </span>to<span class="w"> </span>protect<span class="w"> </span>your<span class="w"> </span>secret<span class="w"> </span>key.
<span class="c1"># Enter passphrase &lt;--</span>

We<span class="w"> </span>need<span class="w"> </span>to<span class="w"> </span>generate<span class="w"> </span>a<span class="w"> </span>lot<span class="w"> </span>of<span class="w"> </span>random<span class="w"> </span>bytes.<span class="w"> </span>It<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span>good<span class="w"> </span>idea<span class="w"> </span>to<span class="w"> </span>perform
some<span class="w"> </span>other<span class="w"> </span>action<span class="w"> </span><span class="o">(</span><span class="nb">type</span><span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>keyboard,<span class="w"> </span>move<span class="w"> </span>the<span class="w"> </span>mouse,<span class="w"> </span>utilize<span class="w"> </span>the
disks<span class="o">)</span><span class="w"> </span>during<span class="w"> </span>the<span class="w"> </span>prime<span class="w"> </span>generation<span class="p">;</span><span class="w"> </span>this<span class="w"> </span>gives<span class="w"> </span>the<span class="w"> </span>random<span class="w"> </span>number
generator<span class="w"> </span>a<span class="w"> </span>better<span class="w"> </span>chance<span class="w"> </span>to<span class="w"> </span>gain<span class="w"> </span>enough<span class="w"> </span>entropy.
.............+++++
..+++++

gpg:<span class="w"> </span>key<span class="w"> </span><span class="o">[</span>your<span class="w"> </span>key<span class="w"> </span>ID<span class="o">]</span><span class="w"> </span>marked<span class="w"> </span>as<span class="w"> </span>ultimately<span class="w"> </span>trusted
public<span class="w"> </span>and<span class="w"> </span>secret<span class="w"> </span>key<span class="w"> </span>created<span class="w"> </span>and<span class="w"> </span>signed.

gpg:<span class="w"> </span>checking<span class="w"> </span>the<span class="w"> </span>trustdb
gpg:<span class="w"> </span><span class="m">3</span><span class="w"> </span>marginal<span class="o">(</span>s<span class="o">)</span><span class="w"> </span>needed,<span class="w"> </span><span class="m">1</span><span class="w"> </span>complete<span class="o">(</span>s<span class="o">)</span><span class="w"> </span>needed,<span class="w"> </span>PGP<span class="w"> </span>trust<span class="w"> </span>model
gpg:<span class="w"> </span>depth:<span class="w"> </span><span class="m">0</span><span class="w">  </span>valid:<span class="w">   </span><span class="m">1</span><span class="w">  </span>signed:<span class="w">   </span><span class="m">0</span><span class="w">  </span>trust:<span class="w"> </span><span class="m">0</span>-,<span class="w"> </span>0q,<span class="w"> </span>0n,<span class="w"> </span>0m,<span class="w"> </span>0f,<span class="w"> </span>1u
pub<span class="w">   </span>4096R/<span class="o">[</span>your<span class="w"> </span>key<span class="w"> </span>ID<span class="o">]</span><span class="w"> </span><span class="m">2017</span>-04-17
<span class="w">      </span>Key<span class="w"> </span><span class="nv">fingerprint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>Key<span class="w"> </span>fingerprint<span class="o">]</span>
uid<span class="w">                  </span><span class="o">[</span>Your<span class="w"> </span>name<span class="o">]</span><span class="w"> </span>&lt;<span class="o">[</span>your<span class="w"> </span>email<span class="w"> </span>address<span class="o">]</span>&gt;
sub<span class="w">   </span>4096R/<span class="o">[</span>Sub<span class="w"> </span>ID<span class="o">]</span><span class="w"> </span><span class="m">2017</span>-04-17
</code></pre></div>

<p>Congratulations! The master key has been created!</p>
<h2>Set your key to prefer strong hashes</h2>
<p>In theory, if hash preferences were set in the <code>gpg.conf</code> file before creating the key, this step should not be necessary. But better safe than sorry.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>gpg<span class="w"> </span>--edit-key<span class="w"> </span><span class="o">[</span>your<span class="w"> </span>email<span class="w"> </span>address<span class="o">]</span>
gpg<span class="w"> </span><span class="o">(</span>GnuPG<span class="o">)</span><span class="w"> </span><span class="m">1</span>.4.11<span class="p">;</span><span class="w"> </span>Copyright<span class="w"> </span><span class="o">(</span>C<span class="o">)</span><span class="w"> </span><span class="m">2010</span><span class="w"> </span>Free<span class="w"> </span>Software<span class="w"> </span>Foundation,<span class="w"> </span>Inc.
This<span class="w"> </span>is<span class="w"> </span>free<span class="w"> </span>software:<span class="w"> </span>you<span class="w"> </span>are<span class="w"> </span>free<span class="w"> </span>to<span class="w"> </span>change<span class="w"> </span>and<span class="w"> </span>redistribute<span class="w"> </span>it.
There<span class="w"> </span>is<span class="w"> </span>NO<span class="w"> </span>WARRANTY,<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>extent<span class="w"> </span>permitted<span class="w"> </span>by<span class="w"> </span>law.

Secret<span class="w"> </span>key<span class="w"> </span>is<span class="w"> </span>available.

gpg:<span class="w"> </span>checking<span class="w"> </span>the<span class="w"> </span>trustdb
gpg:<span class="w"> </span><span class="m">3</span><span class="w"> </span>marginal<span class="o">(</span>s<span class="o">)</span><span class="w"> </span>needed,<span class="w"> </span><span class="m">1</span><span class="w"> </span>complete<span class="o">(</span>s<span class="o">)</span><span class="w"> </span>needed,<span class="w"> </span>PGP<span class="w"> </span>trust<span class="w"> </span>model
gpg:<span class="w"> </span>depth:<span class="w"> </span><span class="m">0</span><span class="w">  </span>valid:<span class="w">   </span><span class="m">1</span><span class="w">  </span>signed:<span class="w">   </span><span class="m">0</span><span class="w">  </span>trust:<span class="w"> </span><span class="m">0</span>-,<span class="w"> </span>0q,<span class="w"> </span>0n,<span class="w"> </span>0m,<span class="w"> </span>0f,<span class="w"> </span>1u
pub<span class="w">  </span>4096R/<span class="o">[</span>Your<span class="w"> </span>key<span class="w"> </span>ID<span class="o">]</span><span class="w">  </span>created:<span class="w"> </span><span class="m">2017</span>-04-17<span class="w">  </span>expires:<span class="w"> </span>never<span class="w">       </span>usage:<span class="w"> </span>SC
<span class="w">                     </span>trust:<span class="w"> </span>ultimate<span class="w">      </span>validity:<span class="w"> </span>ultimate
sub<span class="w">  </span>4096R/<span class="o">[</span>Sub<span class="w"> </span>ID<span class="o">]</span><span class="w">  </span>created:<span class="w"> </span><span class="m">2017</span>-04-17<span class="w">  </span>expires:<span class="w"> </span>never<span class="w">       </span>usage:<span class="w"> </span>E

gpg&gt;<span class="w"> </span><span class="c1"># setpref SHA512 SHA384 SHA256 SHA224 AES256 AES192 AES CAST5 ZLIB BZIP2 ZIP Uncompressed &lt;--</span>

Set<span class="w"> </span>preference<span class="w"> </span>list<span class="w"> </span>to:
<span class="w">     </span>Cypher:<span class="w"> </span>AES256,<span class="w"> </span>AES192,<span class="w"> </span>AES,<span class="w"> </span>CAST5,<span class="w"> </span>3DES
<span class="w">     </span>Digest:<span class="w"> </span>SHA512,<span class="w"> </span>SHA384,<span class="w"> </span>SHA256,<span class="w"> </span>SHA224,<span class="w"> </span>SHA1
<span class="w">     </span>Compression:<span class="w"> </span>ZLIB,<span class="w"> </span>BZIP2,<span class="w"> </span>ZIP,<span class="w"> </span>Uncompressed
<span class="w">     </span>Features:<span class="w"> </span>MDC,<span class="w"> </span>Keyserver<span class="w"> </span>no-modify
Really<span class="w"> </span>update<span class="w"> </span>the<span class="w"> </span>preferences?<span class="w"> </span><span class="o">(</span>y/N<span class="o">)</span><span class="w"> </span><span class="c1"># y &lt;--</span>


You<span class="w"> </span>need<span class="w"> </span>a<span class="w"> </span>passphrase<span class="w"> </span>to<span class="w"> </span>unlock<span class="w"> </span>the<span class="w"> </span>secret<span class="w"> </span>key<span class="w"> </span><span class="k">for</span>
user:<span class="w"> </span><span class="o">[</span>Your<span class="w"> </span>name<span class="o">]</span><span class="w"> </span>&lt;<span class="o">[</span>your<span class="w"> </span>email<span class="w"> </span>address<span class="o">]</span>&gt;
<span class="m">4096</span>-bit<span class="w"> </span>RSA<span class="w"> </span>key,<span class="w"> </span>ID<span class="w"> </span><span class="o">[</span>You<span class="w"> </span>key<span class="w"> </span>ID<span class="o">]</span>,<span class="w"> </span>created<span class="w"> </span><span class="m">2017</span>-04-17

<span class="c1"># Enter passphrase &lt;--</span>

pub<span class="w">  </span>4096R/<span class="o">[</span>Your<span class="w"> </span>key<span class="w"> </span>ID<span class="o">]</span><span class="w">  </span>created:<span class="w"> </span><span class="m">2017</span>-04-17<span class="w">  </span>expires:<span class="w"> </span>never<span class="w">       </span>usage:<span class="w"> </span>SC
<span class="w">                     </span>trust:<span class="w"> </span>ultimate<span class="w">      </span>validity:<span class="w"> </span>ultimate
sub<span class="w">  </span>4096R/<span class="o">[</span>Sub<span class="w"> </span>ID<span class="o">]</span><span class="w">  </span>created:<span class="w"> </span><span class="m">2017</span>-04-17<span class="w">  </span>expires:<span class="w"> </span>never<span class="w">       </span>usage:<span class="w"> </span>E<span class="w">   </span><span class="o">]</span>

gpg&gt;<span class="w"> </span><span class="c1"># save</span>
</code></pre></div>

<h2>Create a signing subkey</h2>
<p>When creating a key GPG automatically creates an encryption subkey as well, which means that only the signing subkey needs manual creation.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>gpg<span class="w"> </span>--edit-key<span class="w"> </span><span class="o">[</span>Your<span class="w"> </span>email<span class="w"> </span>address<span class="o">]</span>
gpg<span class="w"> </span><span class="o">(</span>GnuPG<span class="o">)</span><span class="w"> </span><span class="m">1</span>.4.11<span class="p">;</span><span class="w"> </span>Copyright<span class="w"> </span><span class="o">(</span>C<span class="o">)</span><span class="w"> </span><span class="m">2010</span><span class="w"> </span>Free<span class="w"> </span>Software<span class="w"> </span>Foundation,<span class="w"> </span>Inc.
This<span class="w"> </span>is<span class="w"> </span>free<span class="w"> </span>software:<span class="w"> </span>you<span class="w"> </span>are<span class="w"> </span>free<span class="w"> </span>to<span class="w"> </span>change<span class="w"> </span>and<span class="w"> </span>redistribute<span class="w"> </span>it.
There<span class="w"> </span>is<span class="w"> </span>NO<span class="w"> </span>WARRANTY,<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>extent<span class="w"> </span>permitted<span class="w"> </span>by<span class="w"> </span>law.

Secret<span class="w"> </span>key<span class="w"> </span>is<span class="w"> </span>available.

gpg:<span class="w"> </span>checking<span class="w"> </span>the<span class="w"> </span>trustdb
gpg:<span class="w"> </span><span class="m">3</span><span class="w"> </span>marginal<span class="o">(</span>s<span class="o">)</span><span class="w"> </span>needed,<span class="w"> </span><span class="m">1</span><span class="w"> </span>complete<span class="o">(</span>s<span class="o">)</span><span class="w"> </span>needed,<span class="w"> </span>PGP<span class="w"> </span>trust<span class="w"> </span>model
gpg:<span class="w"> </span>depth:<span class="w"> </span><span class="m">0</span><span class="w">  </span>valid:<span class="w">   </span><span class="m">1</span><span class="w">  </span>signed:<span class="w">   </span><span class="m">0</span><span class="w">  </span>trust:<span class="w"> </span><span class="m">0</span>-,<span class="w"> </span>0q,<span class="w"> </span>0n,<span class="w"> </span>0m,<span class="w"> </span>0f,<span class="w"> </span>1u
pub<span class="w">  </span>4096R/<span class="o">[</span>Your<span class="w"> </span>key<span class="w"> </span>ID<span class="o">]</span><span class="w">  </span>created:<span class="w"> </span><span class="m">2017</span>-04-17<span class="w">  </span>expires:<span class="w"> </span>never<span class="w">       </span>usage:<span class="w"> </span>SC
<span class="w">                         </span>trust:<span class="w"> </span>ultimate<span class="w">      </span>validity:<span class="w"> </span>ultimate
sub<span class="w">  </span>4096R/<span class="o">[</span>Sub<span class="w"> </span>ID<span class="o">]</span><span class="w">  </span>created:<span class="w"> </span><span class="m">2017</span>-04-17<span class="w">  </span>expires:<span class="w"> </span>never<span class="w">       </span>usage:<span class="w"> </span>E<span class="w">   </span><span class="o">]</span>

gpg&gt;<span class="w"> </span><span class="c1"># addkey &lt;--</span>

Key<span class="w"> </span>is<span class="w"> </span>protected.

You<span class="w"> </span>need<span class="w"> </span>a<span class="w"> </span>passphrase<span class="w"> </span>to<span class="w"> </span>unlock<span class="w"> </span>the<span class="w"> </span>secret<span class="w"> </span>key<span class="w"> </span><span class="k">for</span>
user:<span class="w"> </span><span class="o">[</span>Your<span class="w"> </span>name<span class="o">]</span><span class="w"> </span>&lt;<span class="o">[</span>your<span class="w"> </span>email<span class="w"> </span>address<span class="o">]</span>&gt;
<span class="m">4096</span>-bit<span class="w"> </span>RSA<span class="w"> </span>key,<span class="w"> </span>ID<span class="w"> </span><span class="o">[</span>Your<span class="w"> </span>key<span class="w"> </span>ID<span class="o">]</span>,<span class="w"> </span>created<span class="w"> </span><span class="m">2017</span>-04-17
<span class="c1"># Enter passphrase &lt;--</span>

Please<span class="w"> </span><span class="k">select</span><span class="w"> </span>what<span class="w"> </span>kind<span class="w"> </span>of<span class="w"> </span>key<span class="w"> </span>you<span class="w"> </span>want:
<span class="w">    </span><span class="o">(</span><span class="m">3</span><span class="o">)</span><span class="w"> </span>DSA<span class="w"> </span><span class="o">(</span>sign<span class="w"> </span>only<span class="o">)</span>
<span class="w">    </span><span class="o">(</span><span class="m">4</span><span class="o">)</span><span class="w"> </span>RSA<span class="w"> </span><span class="o">(</span>sign<span class="w"> </span>only<span class="o">)</span>
<span class="w">    </span><span class="o">(</span><span class="m">5</span><span class="o">)</span><span class="w"> </span>Elgamal<span class="w"> </span><span class="o">(</span>encrypt<span class="w"> </span>only<span class="o">)</span>
<span class="w">    </span><span class="o">(</span><span class="m">6</span><span class="o">)</span><span class="w"> </span>RSA<span class="w"> </span><span class="o">(</span>encrypt<span class="w"> </span>only<span class="o">)</span>
Your<span class="w"> </span>selection?<span class="w"> </span><span class="c1"># 4 &lt;--</span>

RSA<span class="w"> </span>keys<span class="w"> </span>may<span class="w"> </span>be<span class="w"> </span>between<span class="w"> </span><span class="m">1024</span><span class="w"> </span>and<span class="w"> </span><span class="m">4096</span><span class="w"> </span>bits<span class="w"> </span>long.
What<span class="w"> </span>keysize<span class="w"> </span><span class="k">do</span><span class="w"> </span>you<span class="w"> </span>want?<span class="w"> </span><span class="o">(</span><span class="m">2048</span><span class="o">)</span><span class="w"> </span><span class="c1"># 4096 &lt;-- (the longer the better!)</span>

Requested<span class="w"> </span>keysize<span class="w"> </span>is<span class="w"> </span><span class="m">4096</span><span class="w"> </span>bits
Please<span class="w"> </span>specify<span class="w"> </span>how<span class="w"> </span>long<span class="w"> </span>the<span class="w"> </span>key<span class="w"> </span>should<span class="w"> </span>be<span class="w"> </span>valid.
<span class="w">    </span><span class="nv">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>key<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>expire
<span class="w">    </span>&lt;n&gt;<span class="w">  </span><span class="o">=</span><span class="w"> </span>key<span class="w"> </span>expires<span class="w"> </span><span class="k">in</span><span class="w"> </span>n<span class="w"> </span>days
<span class="w">    </span>&lt;n&gt;w<span class="w"> </span><span class="o">=</span><span class="w"> </span>key<span class="w"> </span>expires<span class="w"> </span><span class="k">in</span><span class="w"> </span>n<span class="w"> </span>weeks
<span class="w">    </span>&lt;n&gt;m<span class="w"> </span><span class="o">=</span><span class="w"> </span>key<span class="w"> </span>expires<span class="w"> </span><span class="k">in</span><span class="w"> </span>n<span class="w"> </span>months
<span class="w">    </span>&lt;n&gt;y<span class="w"> </span><span class="o">=</span><span class="w"> </span>key<span class="w"> </span>expires<span class="w"> </span><span class="k">in</span><span class="w"> </span>n<span class="w"> </span>years
Key<span class="w"> </span>is<span class="w"> </span>valid<span class="w"> </span><span class="k">for</span>?<span class="w"> </span><span class="o">(</span><span class="m">0</span><span class="o">)</span><span class="w"> </span><span class="c1"># 0 &lt;--</span>

Key<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>expire<span class="w"> </span>at<span class="w"> </span>all
Is<span class="w"> </span>this<span class="w"> </span>correct?<span class="w"> </span><span class="o">(</span>y/N<span class="o">)</span><span class="w"> </span><span class="c1"># y &lt;--</span>

Really<span class="w"> </span>create?<span class="w"> </span><span class="o">(</span>y/N<span class="o">)</span><span class="w"> </span><span class="c1"># y &lt;--</span>


pub<span class="w">  </span>4096R/<span class="o">[</span>Your<span class="w"> </span>key<span class="w"> </span>ID<span class="o">]</span><span class="w">  </span>created:<span class="w"> </span><span class="m">2017</span>-04-17<span class="w">  </span>expires:<span class="w"> </span>never<span class="w">       </span>usage:<span class="w"> </span>SC
<span class="w">                         </span>trust:<span class="w"> </span>ultimate<span class="w">      </span>validity:<span class="w"> </span>ultimate
sub<span class="w">  </span>4096R/<span class="o">[</span>Sub<span class="w"> </span>ID<span class="o">]</span><span class="w">  </span>created:<span class="w"> </span><span class="m">2017</span>-04-17<span class="w">  </span>expires:<span class="w"> </span>never<span class="w">       </span>usage:<span class="w"> </span>E<span class="w">   </span><span class="o">]</span>
sub<span class="w">  </span>4096R/<span class="o">[</span>Sub<span class="w"> </span>ID<span class="o">]</span><span class="w">  </span>created:<span class="w"> </span><span class="m">2017</span>-04-17<span class="w">  </span>expires:<span class="w"> </span>never<span class="w">       </span>usage:<span class="w"> </span>S

gpg&gt;<span class="w"> </span><span class="c1"># save &lt;--</span>
</code></pre></div>

<h2>Create a revocation certificate</h2>
<p>If the master key gets lost or compromised, the revocation certificate is going to be your emergency brake.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>gpg<span class="w"> </span>--output<span class="w"> </span>revoke.asc<span class="w"> </span>--gen-revoke<span class="w"> </span><span class="o">[</span>your<span class="w"> </span>email<span class="w"> </span>address<span class="o">]</span>
Create<span class="w"> </span>a<span class="w"> </span>revocation<span class="w"> </span>certificate<span class="w"> </span><span class="k">for</span><span class="w"> </span>this<span class="w"> </span>key?<span class="w"> </span><span class="o">(</span>y/N<span class="o">)</span><span class="w"> </span><span class="c1"># y &lt;--</span>
Please<span class="w"> </span><span class="k">select</span><span class="w"> </span>the<span class="w"> </span>reason<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>revocation:
<span class="w">  </span><span class="nv">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>No<span class="w"> </span>reason<span class="w"> </span>specified
<span class="w">  </span><span class="nv">1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Key<span class="w"> </span>has<span class="w"> </span>been<span class="w"> </span>compromised
<span class="w">  </span><span class="nv">2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Key<span class="w"> </span>is<span class="w"> </span>superseded
<span class="w">  </span><span class="nv">3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Key<span class="w"> </span>is<span class="w"> </span>no<span class="w"> </span>longer<span class="w"> </span>used
<span class="w">  </span><span class="nv">Q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Cancel
<span class="o">(</span>Probably<span class="w"> </span>you<span class="w"> </span>want<span class="w"> </span>to<span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>here<span class="o">)</span>
Your<span class="w"> </span>decision?<span class="w"> </span><span class="c1"># 1 &lt;--</span>
Enter<span class="w"> </span>an<span class="w"> </span>optional<span class="w"> </span>description<span class="p">;</span><span class="w"> </span>end<span class="w"> </span>it<span class="w"> </span>with<span class="w"> </span>an<span class="w"> </span>empty<span class="w"> </span>line:
&gt;<span class="w"> </span><span class="c1"># Empty line will do fine here &lt;--</span>
Reason<span class="w"> </span><span class="k">for</span><span class="w"> </span>revocation:<span class="w"> </span>Key<span class="w"> </span>has<span class="w"> </span>been<span class="w"> </span>compromised
<span class="o">(</span>No<span class="w"> </span>description<span class="w"> </span>given<span class="o">)</span>
Is<span class="w"> </span>this<span class="w"> </span>okay?<span class="w"> </span><span class="o">(</span>y/N<span class="o">)</span><span class="w"> </span><span class="c1"># y &lt;--</span>

You<span class="w"> </span>need<span class="w"> </span>a<span class="w"> </span>passphrase<span class="w"> </span>to<span class="w"> </span>unlock<span class="w"> </span>the<span class="w"> </span>secret<span class="w"> </span>key<span class="w"> </span><span class="k">for</span>
user:<span class="w"> </span><span class="o">[</span>Your<span class="w"> </span>name<span class="o">]</span><span class="w"> </span>&lt;<span class="o">[</span>your<span class="w"> </span>email<span class="w"> </span>address<span class="o">]</span>&gt;
<span class="m">4096</span>-bit<span class="w"> </span>RSA<span class="w"> </span>key,<span class="w"> </span>ID<span class="w"> </span><span class="o">[</span>Your<span class="w"> </span>key<span class="w"> </span>ID<span class="o">]</span>,<span class="w"> </span>created<span class="w"> </span><span class="m">2017</span>-04-17
<span class="c1"># Enter passphrase &lt;--</span>

Revocation<span class="w"> </span>certificate<span class="w"> </span>created.
</code></pre></div>

<p>Make several copies of it and save it in a safe place (ideally not the same one as the master key!)</p>
<h2>Remove the master key</h2>
<p>Before proceeding, make sure to have backups of the <code>.gpg</code> folder (perhaps on an encrypted media)</p>
<p>Temporarily export the subkeys:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>gpg<span class="w"> </span>--export-secret-subkeys<span class="w"> </span><span class="o">[</span>your<span class="w"> </span>email<span class="w"> </span>address<span class="o">]</span><span class="w"> </span>&gt;<span class="w"> </span>/media/encrypted-media/subkeys
</code></pre></div>

<p>Delete the master key:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>gpg<span class="w"> </span>--delete-secret-key<span class="w"> </span>0x6F87F32E2234961E
</code></pre></div>

<p>Re-import the subkeys and remove the temporary export:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>gpg<span class="w"> </span>--import<span class="w"> </span>/media/encrypted-usb/subkeys
$<span class="w"> </span>shred<span class="w"> </span>-u<span class="w"> </span>/media/encrypted-usb/subkeys
</code></pre></div>

<p>Check that everything worked as intended - the hash (#) next to the <code>sec</code> line means that the master key is missing.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>gpg<span class="w"> </span>-K<span class="w"> </span><span class="o">[</span>your<span class="w"> </span>email<span class="w"> </span>address<span class="o">]</span>

/home/username/.gnupg/secring.gpg
-----------------------------
sec#<span class="w">  </span>4096R/<span class="o">[</span>Your<span class="w"> </span>key<span class="w"> </span>ID<span class="o">]</span><span class="w"> </span><span class="m">2017</span>-04-17
uid<span class="w">                  </span><span class="o">[</span>Your<span class="w"> </span>name<span class="o">]</span><span class="w"> </span>&lt;<span class="o">[</span>your<span class="w"> </span>email<span class="w"> </span>address<span class="o">]</span>&gt;
ssb<span class="w">   </span>4096R/<span class="o">[</span>Subkey<span class="w"> </span>ID<span class="o">]</span><span class="w">   </span><span class="m">2017</span>-04-17
ssb<span class="w">   </span>4096R/<span class="o">[</span>Subkey<span class="w"> </span>ID<span class="o">]</span><span class="w">   </span><span class="m">2017</span>-04-17
</code></pre></div>

<h2>Upload the key to a keyserver</h2>
<p>Keyservers syncs keys with each other, so any keyserver would do.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>gpg<span class="w"> </span>--keyserver<span class="w"> </span>pgp.mit.edu<span class="w"> </span>--send-key<span class="w"> </span><span class="o">[</span>your<span class="w"> </span>key<span class="w"> </span>ID<span class="o">]</span>
</code></pre></div>

<h2>Using your master key</h2>
<p>Assuming that the <code>.gpg</code> folder is on some kind of encrypted media:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>gpg<span class="w"> </span>--homedir<span class="o">=</span>/media/encrypted-media/.gnupg/<span class="w"> </span><span class="o">[</span>gpg<span class="w"> </span>command<span class="o">]</span>
</code></pre></div>

<h2>Parting thoughts</h2>
<p>That's it!</p>
<p>There is probably a lot more to say, but this seems quite enough stuff to read already. Below there's a list of links that are worthed reading and/or served me as source of inspiration.</p>
<p>Also, I am not an expert at this, so corrections to any mistake I might have made are more than welcome!</p>
<h3>Resources</h3>
<ul>
<li><a href="https://riseup.net/en/security/message-security/openpgp/best-practices">OpenPGP Best Practices</a></li>
<li><a href="https://www.gnupg.org/gph/en/manual/book1.html">The GNU Privacy handbook</a></li>
<li><a href="https://wiki.debian.org/Subkeys?action=show&amp;redirect=subkeys">Subkeys - Debian wiki</a></li>
<li><a href="https://debian-administration.org/users/dkg/weblog/48">HOWTO prep for migration off of SHA-1 in OpenPGP</a></li>
<li><a href="https://www.void.gr/kargig/blog/2013/12/02/creating-a-new-gpg-key-with-subkeys/">Creating a new GPG key with subkeys</a></li>
<li><a href="https://alexcabal.com/creating-the-perfect-gpg-keypair/">Creating the perfect GPG keypair</a></li>
<li><a href="http://ekaia.org/blog/2009/05/10/creating-new-gpgkey/">Creating a new GPG key</a></li>
<li><a href="http://blog.clusterlabs.org/blog/2013/gpg-quickstart">GPG Quickstart</a></li>
<li><a href="https://spin.atomicobject.com/2013/11/24/secure-gpg-keys-guide/">Generating More Secure GPG Keys: A Step-by-Step Guide</a></li>
</ul>
            <a href="#" class="go-top">Go Top</a>
<footer class="footer">
    <p>&copy; Railslide <a href="http://creativecommons.org/licenses/by-sa/4.0/">(CC BY-SA 4.0)</a> &ndash;
        Built with <a href="http://blog.getpelican.com/">Pelican</a>
        and a modified version of <a href="https://github.com/PurePelicanTheme/pure-single">Pure Theme</a>
    </p>
</footer>        </div>
    </div>
    </div>
    <script>
        var $top = $('.go-top');

        // Show or hide the sticky footer button
        $(window).scroll(function() {
            if ($(this).scrollTop() > 200) {
                $top.fadeIn(200);
            } else {
                $top.fadeOut(200);
            }
        });

        // Animate the scroll to top
        $top.click(function(event) {
            event.preventDefault();
            $('html, body').animate({scrollTop: 0}, 300);
        })

        // Makes sure that the href="#" attached to the <a> elements
        // don't scroll you back up the page.
        $('body').on('click', 'a[href="#"]', function(event) {
            event.preventDefault();
        });
    </script>

</body>
</html>